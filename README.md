# Adguard Home for Magisk

> 在 Magisk 上运行 Adguard Home 程序

使用前需关闭私人dns，不可用wap接入点，AdHome后台管理地址http://127.0.0.1:3000，用户名/密码root (若面具页面显示运行中，但无法打开后台，则可能是系统被精简web服务相关导致，或者换浏览器试下)，本机流量数据或wifi都支持过滤，AdHome后台有数据变化代表模块生效，以下所有配置参数修改即时生效，无需重启。

# ↓↓↓特殊使用环境说明↓↓↓

1. VPN类软件：若使用模式1，VPN类软件可设置域名分流或应用分流的方式实现不走VPN的过滤，走VPN的不过滤。若使用模式2或3，SSR软件默认设置可用可过滤、V2RayNG软件默认设置可用可过滤，Clash软件默认设置加勾选网络-系统代理(可用但无法过滤)，其它软件自行测试。

2. 免流类Magisk模块：免流类模块在全局规则模式下，AdHome的模式1、模式2或3都可以使用。

3. 翻墙类Magisk模块：AdHome后台里的DNS上游需全部删除，加一条：127.0.0.1:X (X是翻墙模块的监听端口)，AdHome的模式1、模式2或3都可以使用。

4. 路由端翻墙插件：AdHome后台里的DNS上游仅保留10.35.53.10:3553，其它删除，仅可使用模式1，且不可以打开VPN(否则没网)。

5. 模块默认监听端口为5591，若你有特殊需求，可在AdGuardHome.yaml文件修改  port: 5591 需要重启生效。(注意：若使用53端口，则无法开启热点)

6. 模块默认仅支持本机打开后台，若你需要同局域网其它设备打开后台，可在AdGuardHome.yaml文件修改  address: 127.0.0.1:3000为  address: 0.0.0.0:3000 需要重启生效

7. 如果模块无法获取到本机默认的dns，将无法使用模式1，模块将自动强制使用模式2或3，Magisk应用里可查看当前模式，或执行testing.sh脚本可查询当前模式以及其它更多信息。

# 为什么要做这个模块

> 这个模块是由topdalao制作的模块改版的，经过了一番研究，我精简掉了大部分代码，更换了默认规则，二改有着更好的性能，且不会强制更新（后续会加上magisk自带的更新链接），该模块仅供学习交流，如各路大神有好的建议欢迎指出！